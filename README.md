# StaFi Validator Ejector

The ETH validator running through the StaFi protocol needs to run this client, which listens to events that require validators to exit. It will automatically send out an exit transaction when necessary.

## Requirements

* [Go 1.19+](https://golang.org/dl/), for example:

```bash
cd $HOME
wget -O go1.19.2.linux-amd64.tar.gz https://go.dev/dl/go1.19.2.linux-amd64.tar.gz
rm -rf /usr/local/go && tar -C /usr/local -xzf go1.19.2.linux-amd64.tar.gz && rm go1.19.2.linux-amd64.tar.gz
echo 'export GOROOT=/usr/local/go' >> $HOME/.bashrc
echo 'export GOPATH=$HOME/go' >> $HOME/.bashrc
echo 'export GO111MODULE=on' >> $HOME/.bashrc
echo 'export PATH=$PATH:/usr/local/go/bin:$HOME/go/bin' >> $HOME/.bashrc && . $HOME/.bashrc
go version
```

* Keystores generated by [eth2.0-deposit-cli](https://github.com/stafiprotocol/eth2.0-deposit-cli)
* Execution node RPC endpoint
* Consensus node RPC endpoint

## Environment Variables

Options are configured via environment variables.

| Variable                   | Required | Example       | Description                                                                                                                                                                                                                                             |
| -------------------------- | -------- | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| execution_endpoint         | Yes      | http://127.0.0.1:8545   | Ethereum Execution Node endpoint                                                                                                                                                                                                                        |
| consensus_endpoint         | Yes      | http://127.0.0.1:5051   | Ethereum Consensus Node endpoint                                                                                                                                                                                                                        |
| keys_dir                   | Yes      | ~/validator_keys      | Full path to your validator keys folder, which should include keystore-m_*.json files generated by [eth2.0-deposit-cli](https://github.com/stafiprotocol/eth2.0-deposit-cli)


## Running

```
git clone https://github.com/stafiprotocol/eth-ejector.git
cd eth-ejector
git checkout <latest-release-tag>
make build
./build/eth-ejector start --keys_dir <YOUR_KEYS_FOLDER_PATH> --consensus_endpoint <CONSENSUS_ENDPOINT>  --execution_endpoint <EXECUTION_ENDPOINT>
```

Example:
```
git clone https://github.com/stafiprotocol/eth-ejector.git
cd eth-ejector
git checkout v0.3.1
make build
./build/eth-ejector start --keys_dir /home/stafi/eth2.0/validator_keys --consensus_endpoint https://beacon.zhejiang.ethpandaops.io  --execution_endpoint https://rpc.zhejiang.ethpandaops.io
```
